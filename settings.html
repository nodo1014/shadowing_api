<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>렌더링 설정 - Shadowing Maker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        h1 {
            margin-bottom: 30px;
            color: #2c3e50;
            text-align: center;
        }
        
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 30px;
        }
        
        .settings-section {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .settings-section h2 {
            color: #3498db;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #ecf0f1;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #555;
        }
        
        input[type="number"],
        input[type="text"],
        select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        
        input[type="number"]:focus,
        input[type="text"]:focus,
        select:focus {
            outline: none;
            border-color: #3498db;
        }
        
        input[type="range"] {
            width: 100%;
            margin: 10px 0;
        }
        
        .range-value {
            text-align: center;
            font-size: 14px;
            color: #666;
            margin-top: 5px;
        }
        
        .color-input-wrapper {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        input[type="color"] {
            width: 50px;
            height: 40px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .checkbox-wrapper {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 30px;
            justify-content: center;
        }
        
        button {
            padding: 12px 30px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-save {
            background-color: #27ae60;
            color: white;
        }
        
        .btn-save:hover {
            background-color: #229954;
        }
        
        .btn-reset {
            background-color: #e74c3c;
            color: white;
        }
        
        .btn-reset:hover {
            background-color: #c0392b;
        }
        
        .btn-load {
            background-color: #3498db;
            color: white;
        }
        
        .btn-load:hover {
            background-color: #2980b9;
        }
        
        .message {
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
            text-align: center;
            display: none;
        }
        
        .message.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .message.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        @media (max-width: 768px) {
            .settings-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>렌더링 설정</h1>
        
        <div class="message" id="message"></div>
        
        <div class="settings-grid">
            <!-- TTS 설정 -->
            <div class="settings-section">
                <h2>🎤 TTS 설정</h2>
                
                <div class="form-group">
                    <label for="voice_korean">한국어 음성</label>
                    <select id="voice_korean" name="voice_korean">
                        <option value="ko-KR-SunHiNeural">Sun-Hi (여성)</option>
                        <option value="ko-KR-InJoonNeural">InJoon (남성)</option>
                        <option value="ko-KR-BongJinNeural">BongJin (남성)</option>
                        <option value="ko-KR-JiMinNeural">JiMin (여성)</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="voice_english">영어 음성</label>
                    <select id="voice_english" name="voice_english">
                        <option value="en-US-AriaNeural">Aria (여성)</option>
                        <option value="en-US-JennyNeural">Jenny (여성)</option>
                        <option value="en-US-GuyNeural">Guy (남성)</option>
                        <option value="en-US-EricNeural">Eric (남성)</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="tts_speed">속도 조절: <span id="speed_value">0%</span></label>
                    <input type="range" id="tts_speed" min="-50" max="50" value="0">
                </div>
                
                <div class="form-group">
                    <label for="tts_pitch">피치 조절: <span id="pitch_value">0Hz</span></label>
                    <input type="range" id="tts_pitch" min="-50" max="50" value="0">
                </div>
                
                <div class="form-group">
                    <label for="tts_volume">볼륨: <span id="volume_value">100%</span></label>
                    <input type="range" id="tts_volume" min="0" max="100" value="100">
                </div>
            </div>
            
            <!-- 비디오 인코딩 설정 -->
            <div class="settings-section">
                <h2>🎥 비디오 인코딩 설정</h2>
                
                <div class="form-group">
                    <label for="video_crf">품질 (CRF)</label>
                    <input type="number" id="video_crf" min="16" max="28" value="16">
                    <small style="color: #666;">낮을수록 고품질 (16-28)</small>
                </div>
                
                <div class="form-group">
                    <label for="video_preset">인코딩 속도</label>
                    <select id="video_preset" name="video_preset">
                        <option value="ultrafast">초고속 (품질 낮음)</option>
                        <option value="fast">빠름</option>
                        <option value="medium" selected>보통 (권장)</option>
                        <option value="slow">느림 (품질 높음)</option>
                        <option value="veryslow">매우 느림 (최고 품질)</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="video_resolution">해상도</label>
                    <select id="video_resolution" name="video_resolution">
                        <option value="original">원본</option>
                        <option value="720p">720p</option>
                        <option value="1080p">1080p</option>
                        <option value="4k">4K</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="video_framerate">프레임레이트</label>
                    <select id="video_framerate" name="video_framerate">
                        <option value="24">24 fps</option>
                        <option value="30" selected>30 fps</option>
                        <option value="60">60 fps</option>
                    </select>
                </div>
            </div>
            
            <!-- 자막 스타일 설정 -->
            <div class="settings-section">
                <h2>📝 자막 스타일 설정</h2>
                
                <div class="form-group">
                    <label for="subtitle_font_english">영어 자막 폰트</label>
                    <select id="subtitle_font_english" name="subtitle_font_english">
                        <option value="Noto Sans CJK KR">Noto Sans CJK KR</option>
                        <option value="NanumGothic">나눔고딕</option>
                        <option value="Malgun Gothic">맑은 고딕</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="subtitle_size_english">영어 자막 크기</label>
                    <input type="number" id="subtitle_size_english" min="20" max="100" value="60">
                </div>
                
                <div class="form-group">
                    <label for="subtitle_color_english">영어 자막 색상</label>
                    <div class="color-input-wrapper">
                        <input type="color" id="subtitle_color_english" value="#FFFFFF">
                        <input type="text" id="subtitle_color_english_text" value="#FFFFFF" readonly>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="subtitle_size_korean">한글 자막 크기</label>
                    <input type="number" id="subtitle_size_korean" min="20" max="100" value="50">
                </div>
                
                <div class="form-group">
                    <label for="subtitle_color_korean">한글 자막 색상</label>
                    <div class="color-input-wrapper">
                        <input type="color" id="subtitle_color_korean" value="#FFD700">
                        <input type="text" id="subtitle_color_korean_text" value="#FFD700" readonly>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="subtitle_border_width">테두리 두께</label>
                    <input type="number" id="subtitle_border_width" min="0" max="10" value="3">
                </div>
            </div>
            
            <!-- 템플릿 설정 -->
            <div class="settings-section">
                <h2>🎨 템플릿 설정</h2>
                
                <div class="form-group">
                    <label for="gap_duration">클립 간격 (초)</label>
                    <input type="number" id="gap_duration" min="0" max="5" step="0.5" value="1.5">
                </div>
                
                <div class="form-group checkbox-wrapper">
                    <input type="checkbox" id="fade_effect">
                    <label for="fade_effect">페이드 효과</label>
                </div>
                
                <div class="form-group checkbox-wrapper">
                    <input type="checkbox" id="show_title" checked>
                    <label for="show_title">제목 표시</label>
                </div>
                
                <div class="form-group">
                    <label for="bg_music_volume">배경음악 볼륨: <span id="bg_music_value">20%</span></label>
                    <input type="range" id="bg_music_volume" min="0" max="100" value="20">
                </div>
            </div>
            
            <!-- 쇼츠 설정 -->
            <div class="settings-section">
                <h2>📱 쇼츠 전용 설정</h2>
                
                <div class="form-group">
                    <label for="shorts_aspect_ratio">크롭 방식</label>
                    <select id="shorts_aspect_ratio" name="shorts_aspect_ratio">
                        <option value="center">중앙 크롭</option>
                        <option value="origin">원본 비율</option>
                        <option value="top">상단 기준</option>
                        <option value="bottom">하단 기준</option>
                        <option value="face">얼굴 인식</option>
                        <option value="zoom">80% 확대</option>
                        <option value="wide">와이드 크롭</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="thumbnail_darken">썸네일 어둡게: <span id="darken_value">10%</span></label>
                    <input type="range" id="thumbnail_darken" min="0" max="100" value="10">
                </div>
                
                <div class="form-group">
                    <label for="intro_duration">인트로 길이 (초)</label>
                    <input type="number" id="intro_duration" min="1" max="5" value="3">
                </div>
            </div>
            
            <!-- 고급 설정 -->
            <div class="settings-section">
                <h2>⚙️ 고급 설정</h2>
                
                <div class="form-group">
                    <label for="hardware_accel">하드웨어 가속</label>
                    <select id="hardware_accel" name="hardware_accel">
                        <option value="none">사용 안 함</option>
                        <option value="nvidia">NVIDIA GPU</option>
                        <option value="amd">AMD GPU</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="threads">스레드 수</label>
                    <input type="number" id="threads" min="0" max="32" value="0">
                    <small style="color: #666;">0 = 자동</small>
                </div>
                
                <div class="form-group">
                    <label for="temp_path">임시 파일 경로</label>
                    <input type="text" id="temp_path" value="/tmp">
                </div>
                
                <div class="form-group">
                    <label for="output_format">출력 형식</label>
                    <select id="output_format" name="output_format">
                        <option value="mp4">MP4</option>
                        <option value="webm">WebM</option>
                        <option value="mkv">MKV</option>
                    </select>
                </div>
            </div>
        </div>
        
        <div class="button-group">
            <button class="btn-load" onclick="loadSettings()">설정 불러오기</button>
            <button class="btn-save" onclick="saveSettings()">설정 저장</button>
            <button class="btn-reset" onclick="resetSettings()">초기화</button>
        </div>
    </div>
    
    <script>
        // Range input 값 표시 업데이트
        document.getElementById('tts_speed').addEventListener('input', function() {
            document.getElementById('speed_value').textContent = this.value + '%';
        });
        
        document.getElementById('tts_pitch').addEventListener('input', function() {
            document.getElementById('pitch_value').textContent = this.value + 'Hz';
        });
        
        document.getElementById('tts_volume').addEventListener('input', function() {
            document.getElementById('volume_value').textContent = this.value + '%';
        });
        
        document.getElementById('bg_music_volume').addEventListener('input', function() {
            document.getElementById('bg_music_value').textContent = this.value + '%';
        });
        
        document.getElementById('thumbnail_darken').addEventListener('input', function() {
            document.getElementById('darken_value').textContent = this.value + '%';
        });
        
        // Color input 동기화
        document.getElementById('subtitle_color_english').addEventListener('input', function() {
            document.getElementById('subtitle_color_english_text').value = this.value;
        });
        
        document.getElementById('subtitle_color_korean').addEventListener('input', function() {
            document.getElementById('subtitle_color_korean_text').value = this.value;
        });
        
        function showMessage(text, type) {
            const messageEl = document.getElementById('message');
            messageEl.textContent = text;
            messageEl.className = 'message ' + type;
            messageEl.style.display = 'block';
            
            setTimeout(() => {
                messageEl.style.display = 'none';
            }, 3000);
        }
        
        async function loadSettings() {
            try {
                const response = await fetch('/api/settings');
                const settings = await response.json();
                
                // TTS 설정
                document.getElementById('voice_korean').value = settings.tts.voice_korean;
                document.getElementById('voice_english').value = settings.tts.voice_english;
                document.getElementById('tts_speed').value = settings.tts.speed;
                document.getElementById('tts_pitch').value = settings.tts.pitch;
                document.getElementById('tts_volume').value = settings.tts.volume;
                
                // 비디오 설정
                document.getElementById('video_crf').value = settings.video.crf;
                document.getElementById('video_preset').value = settings.video.preset;
                document.getElementById('video_resolution').value = settings.video.resolution;
                document.getElementById('video_framerate').value = settings.video.framerate;
                
                // 자막 설정
                document.getElementById('subtitle_font_english').value = settings.subtitle.font_english;
                document.getElementById('subtitle_size_english').value = settings.subtitle.size_english;
                document.getElementById('subtitle_color_english').value = settings.subtitle.color_english;
                document.getElementById('subtitle_color_english_text').value = settings.subtitle.color_english;
                document.getElementById('subtitle_size_korean').value = settings.subtitle.size_korean;
                document.getElementById('subtitle_color_korean').value = settings.subtitle.color_korean;
                document.getElementById('subtitle_color_korean_text').value = settings.subtitle.color_korean;
                document.getElementById('subtitle_border_width').value = settings.subtitle.border_width;
                
                // 템플릿 설정
                document.getElementById('gap_duration').value = settings.template.gap_duration;
                document.getElementById('fade_effect').checked = settings.template.fade_effect;
                document.getElementById('show_title').checked = settings.template.show_title;
                document.getElementById('bg_music_volume').value = settings.template.background_music_volume;
                
                // 쇼츠 설정
                document.getElementById('shorts_aspect_ratio').value = settings.shorts.aspect_ratio;
                document.getElementById('thumbnail_darken').value = settings.shorts.thumbnail_darken;
                document.getElementById('intro_duration').value = settings.shorts.intro_duration;
                
                // 고급 설정
                document.getElementById('hardware_accel').value = settings.advanced.hardware_accel;
                document.getElementById('threads').value = settings.advanced.threads;
                document.getElementById('temp_path').value = settings.advanced.temp_path;
                document.getElementById('output_format').value = settings.advanced.output_format;
                
                // Range 값 업데이트
                document.getElementById('speed_value').textContent = settings.tts.speed + '%';
                document.getElementById('pitch_value').textContent = settings.tts.pitch + 'Hz';
                document.getElementById('volume_value').textContent = settings.tts.volume + '%';
                document.getElementById('bg_music_value').textContent = settings.template.background_music_volume + '%';
                document.getElementById('darken_value').textContent = settings.shorts.thumbnail_darken + '%';
                
                showMessage('설정을 불러왔습니다.', 'success');
            } catch (error) {
                showMessage('설정 불러오기 실패: ' + error.message, 'error');
            }
        }
        
        async function saveSettings() {
            const settings = {
                tts: {
                    voice_korean: document.getElementById('voice_korean').value,
                    voice_english: document.getElementById('voice_english').value,
                    speed: parseInt(document.getElementById('tts_speed').value),
                    pitch: parseInt(document.getElementById('tts_pitch').value),
                    volume: parseInt(document.getElementById('tts_volume').value)
                },
                video: {
                    crf: parseInt(document.getElementById('video_crf').value),
                    preset: document.getElementById('video_preset').value,
                    resolution: document.getElementById('video_resolution').value,
                    framerate: parseInt(document.getElementById('video_framerate').value)
                },
                subtitle: {
                    font_english: document.getElementById('subtitle_font_english').value,
                    font_korean: document.getElementById('subtitle_font_english').value,
                    size_english: parseInt(document.getElementById('subtitle_size_english').value),
                    size_korean: parseInt(document.getElementById('subtitle_size_korean').value),
                    color_english: document.getElementById('subtitle_color_english').value,
                    color_korean: document.getElementById('subtitle_color_korean').value,
                    border_width: parseInt(document.getElementById('subtitle_border_width').value),
                    border_color: "#000000",
                    position: "bottom",
                    margin_bottom: 300
                },
                template: {
                    gap_duration: parseFloat(document.getElementById('gap_duration').value),
                    fade_effect: document.getElementById('fade_effect').checked,
                    show_title: document.getElementById('show_title').checked,
                    background_music_volume: parseInt(document.getElementById('bg_music_volume').value)
                },
                shorts: {
                    aspect_ratio: document.getElementById('shorts_aspect_ratio').value,
                    thumbnail_darken: parseInt(document.getElementById('thumbnail_darken').value),
                    intro_duration: parseInt(document.getElementById('intro_duration').value)
                },
                advanced: {
                    hardware_accel: document.getElementById('hardware_accel').value,
                    threads: parseInt(document.getElementById('threads').value),
                    temp_path: document.getElementById('temp_path').value,
                    output_format: document.getElementById('output_format').value
                }
            };
            
            try {
                const response = await fetch('/api/settings', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(settings)
                });
                
                if (response.ok) {
                    showMessage('설정이 저장되었습니다.', 'success');
                } else {
                    throw new Error('설정 저장 실패');
                }
            } catch (error) {
                showMessage('설정 저장 실패: ' + error.message, 'error');
            }
        }
        
        async function resetSettings() {
            if (confirm('모든 설정을 기본값으로 초기화하시겠습니까?')) {
                try {
                    const response = await fetch('/api/settings/reset', {
                        method: 'POST'
                    });
                    
                    if (response.ok) {
                        await loadSettings();
                        showMessage('설정이 초기화되었습니다.', 'success');
                    } else {
                        throw new Error('설정 초기화 실패');
                    }
                } catch (error) {
                    showMessage('설정 초기화 실패: ' + error.message, 'error');
                }
            }
        }
        
        // 페이지 로드 시 설정 불러오기
        window.addEventListener('DOMContentLoaded', loadSettings);
    </script>
</body>
</html>