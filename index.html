<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Clipping Service</title>
    <link rel="stylesheet" href="frontend/css/styles.css">
    <link rel="stylesheet" href="frontend/css/app.css">
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h2>Video Clipping</h2>
            </div>
            <nav class="sidebar-nav">
                <button class="nav-item active" data-page="manage">클립 관리</button>
                <button class="nav-item" data-page="single">단일 클립 생성</button>
                <button class="nav-item" data-page="batch">배치 클립 생성</button>
                <button class="nav-item" data-page="templates">템플릿 가이드</button>
                <button class="nav-item" data-page="settings">설정</button>
                <button class="nav-item" data-page="admin">관리자</button>
                <a href="/restful" class="nav-item" style="text-decoration: none; text-align: center;">RESTful API</a>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- 클립 관리 페이지 -->
            <div class="page active" id="manage-page">
                <div class="page-header">
                    <h1 class="page-title">클립 관리</h1>
                    <p class="page-subtitle">생성된 클립을 조회하고 관리합니다</p>
                </div>

                <!-- 필터 및 뷰 전환 -->
                <div class="filters">
                    <div class="filter-row">
                        <div class="form-group">
                            <label>상태</label>
                            <select id="filter-status" onchange="applyFilters()">
                                <option value="">전체</option>
                                <option value="completed">완료</option>
                                <option value="processing">처리중</option>
                                <option value="failed">실패</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>기간</label>
                            <select id="filter-period" onchange="applyFilters()">
                                <option value="all">전체</option>
                                <option value="today">오늘</option>
                                <option value="week">이번 주</option>
                                <option value="month">이번 달</option>
                            </select>
                        </div>
                        <button class="submit-btn" onclick="refreshJobs()">새로고침</button>
                        <button id="bulk-delete-btn" class="delete-btn" style="display: none;" onclick="deleteSelectedJobs()">선택 삭제</button>
                        
                        <div class="view-toggle">
                            <button id="list-view-btn" class="view-btn" onclick="switchView('list')">
                                <span>리스트</span>
                            </button>
                            <button id="grid-view-btn" class="view-btn active" onclick="switchView('grid')">
                                <span>썸네일</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- 작업 목록 - 테이블 뷰 -->
                <div class="jobs-table hidden" id="jobs-table">
                    <table>
                        <thead>
                            <tr>
                                <th style="width: 40px;">
                                    <input type="checkbox" id="select-all" onchange="toggleAllJobs(this)">
                                </th>
                                <th>생성일시</th>
                                <th>미디어</th>
                                <th>구간</th>
                                <th>템플릿</th>
                                <th>상태</th>
                                <th>영문 자막</th>
                                <th>작업</th>
                            </tr>
                        </thead>
                        <tbody id="jobs-list">
                            <!-- 동적으로 추가됨 -->
                        </tbody>
                    </table>
                </div>
                
                <!-- 작업 목록 - 썸네일 그리드 뷰 -->
                <div class="jobs-grid" id="jobs-grid">
                    <!-- 동적으로 추가됨 -->
                </div>
            </div>

            <!-- 단일 클립 페이지 -->
            <div class="page" id="single-page">
                <div class="page-header">
                    <h1 class="page-title">단일 클립 생성</h1>
                    <p class="page-subtitle">하나의 클립을 생성합니다</p>
                </div>

                <div class="clip-form">
                    <div class="form-group">
                        <label for="media-path">미디어 파일 경로 *</label>
                        <input type="text" id="media-path" placeholder="/mnt/qnap/media_eng/indexed_media/animation/KPOP.Demon.Hunters/S01E01.mp4" value="/mnt/qnap/media_eng/indexed_media/animation/KPop.Demon.Hunters.2025.1080p.WEBRip.x264.AAC5.1-[YTS.MX].mp4" required>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="start-time">시작 시간 (초) *</label>
                            <input type="number" id="start-time" step="0.1" min="0" placeholder="10.5" value="10.5" required>
                        </div>
                        <div class="form-group">
                            <label for="end-time">종료 시간 (초) *</label>
                            <input type="number" id="end-time" step="0.1" min="0" placeholder="15.5" value="15.5" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="text-eng">영문 자막 *</label>
                        <textarea id="text-eng" rows="2" placeholder="Hello, how are you?" required>Hello, how are you?</textarea>
                    </div>

                    <div class="form-group">
                        <label for="text-kor">한국어 번역 *</label>
                        <textarea id="text-kor" rows="2" placeholder="안녕하세요, 어떻게 지내세요?" required>안녕하세요, 어떻게 지내세요?</textarea>
                    </div>

                    <div class="form-group">
                        <label for="note">문장 설명</label>
                        <textarea id="note" rows="2" placeholder="인사하기">인사하는 표현</textarea>
                    </div>

                    <div class="form-group">
                        <label for="keywords">키워드 (쉼표로 구분)</label>
                        <input type="text" id="keywords" placeholder="Hello, how" value="Hello, how">
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="clipping-type">클리핑 타입 *</label>
                            <select id="clipping-type">
                                <option value="1">Type 1: 기본</option>
                                <option value="2">Type 2: 확장</option>
                            </select>
                        </div>
                        <div class="form-group checkbox-group">
                            <label>
                                <input type="checkbox" id="individual-clips">
                                개별 클립 저장
                            </label>
                        </div>
                    </div>

                    <button class="submit-btn" onclick="createSingleClip()">클립 생성</button>
                </div>

                <!-- 작업 상태 -->
                <div class="job-status hidden" id="job-status">
                    <h3>작업 상태</h3>
                    <div class="status-header">
                        <span class="job-id" id="current-job-id"></span>
                        <span class="status-badge" id="status-badge">pending</span>
                    </div>
                    <div class="progress-container">
                        <div class="progress-bar" id="progress-bar"></div>
                    </div>
                    <div class="status-message" id="status-message">작업 대기 중...</div>
                    <div class="action-buttons">
                        <button class="download-btn hidden" id="download-btn" onclick="downloadClip()">다운로드</button>
                        <button class="cancel-btn" onclick="cancelJob()">취소</button>
                    </div>
                </div>
            </div>

            <!-- 배치 클립 페이지 -->
            <div class="page" id="batch-page">
                <div class="page-header">
                    <h1 class="page-title">배치 클립 생성</h1>
                    <p class="page-subtitle">여러 클립을 한번에 생성합니다</p>
                </div>

                <div class="clip-form">
                    <div class="form-group">
                        <label for="batch-media-path">미디어 파일 경로 *</label>
                        <input type="text" id="batch-media-path" placeholder="/mnt/qnap/media_eng/indexed_media/animation/KPOP.Demon.Hunters/S01E01.mp4" value="/mnt/qnap/media_eng/indexed_media/animation/KPop.Demon.Hunters.2025.1080p.WEBRip.x264.AAC5.1-[YTS.MX].mp4" required>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="batch-clipping-type">클리핑 타입 *</label>
                            <select id="batch-clipping-type">
                                <option value="1">Type 1: 기본</option>
                                <option value="2">Type 2: 확장</option>
                            </select>
                        </div>
                        <div class="form-group checkbox-group">
                            <label>
                                <input type="checkbox" id="batch-individual-clips">
                                개별 클립 저장
                            </label>
                        </div>
                    </div>

                    <div class="clips-container">
                        <h3>클립 목록</h3>
                        <div id="clips-list">
                            <!-- 동적으로 추가됨 -->
                        </div>
                        <button class="add-clip-btn" onclick="addClipEntry()">클립 추가</button>
                    </div>

                    <button class="submit-btn" onclick="createBatchClips()">배치 생성</button>
                </div>

                <!-- 배치 작업 상태 -->
                <div class="job-status hidden" id="batch-job-status">
                    <h3>배치 작업 상태</h3>
                    <div class="status-header">
                        <span class="job-id" id="batch-job-id"></span>
                        <span class="status-badge" id="batch-status-badge">pending</span>
                    </div>
                    <div class="progress-container">
                        <div class="progress-bar" id="batch-progress-bar"></div>
                    </div>
                    <div class="status-message" id="batch-status-message">작업 대기 중...</div>
                    <div id="batch-results" class="batch-results"></div>
                </div>
            </div>

            <!-- 템플릿 가이드 페이지 -->
            <div class="page" id="templates-page">
                <div class="page-header">
                    <h1 class="page-title">템플릿 가이드</h1>
                    <p class="page-subtitle">각 템플릿의 특징과 활용법</p>
                </div>

                <div class="templates-guide">
                    <!-- Template 1 -->
                    <div class="template-card">
                        <div class="template-header">
                            <div class="template-number">Template 1</div>
                            <div class="template-name">Progressive Learning</div>
                            <div class="template-subtitle">완벽한 5단계 점진적 학습</div>
                        </div>
                        
                        <div class="template-content">
                            <div class="template-flow">
                                <div class="flow-step">
                                    <span class="step-number">1</span>
                                    <span class="step-label">무자막</span>
                                    <span class="step-desc">순수 듣기</span>
                                </div>
                                <div class="flow-arrow">→</div>
                                <div class="flow-step">
                                    <span class="step-number">2</span>
                                    <span class="step-label">블랭크</span>
                                    <span class="step-desc">단어 추론</span>
                                </div>
                                <div class="flow-arrow">→</div>
                                <div class="flow-step">
                                    <span class="step-number">3</span>
                                    <span class="step-label">블랭크+한글</span>
                                    <span class="step-desc">의미 이해</span>
                                </div>
                                <div class="flow-arrow">→</div>
                                <div class="flow-step">
                                    <span class="step-number">4</span>
                                    <span class="step-label">영한자막</span>
                                    <span class="step-desc">완전 확인</span>
                                </div>
                                <div class="flow-arrow">→</div>
                                <div class="flow-step">
                                    <span class="step-number">5</span>
                                    <span class="step-label">무자막 복습</span>
                                    <span class="step-desc">실력 점검</span>
                                </div>
                            </div>
                            
                            <div class="template-features">
                                <div class="feature">
                                    <strong>유튜브 썸네일:</strong> "완벽한 5단계 영어 학습법", "shadowing 마스터 과정"
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Template 2 -->
                    <div class="template-card">
                        <div class="template-header">
                            <div class="template-number">Template 2</div>
                            <div class="template-name">Keyword Focus</div>
                            <div class="template-subtitle">핵심 단어 집중 공략</div>
                        </div>
                        
                        <div class="template-content">
                            <div class="template-flow">
                                <div class="flow-step">
                                    <span class="step-number">1</span>
                                    <span class="step-label">무자막</span>
                                    <span class="step-desc">전체 듣기</span>
                                </div>
                                <div class="flow-arrow">→</div>
                                <div class="flow-step">
                                    <span class="step-number">2</span>
                                    <span class="step-label">키워드 블랭크</span>
                                    <span class="step-desc">핵심 추론</span>
                                </div>
                                <div class="flow-arrow">→</div>
                                <div class="flow-step">
                                    <span class="step-number">3</span>
                                    <span class="step-label">영한자막 x2</span>
                                    <span class="step-desc">강화 학습</span>
                                </div>
                            </div>
                            
                            <div class="template-features">
                                <div class="feature">
                                    <strong>유튜브 썸네일:</strong> "10분만에 핵심 단어 마스터", "스마트 영어 학습법"
                                </div>
                                <div class="feature required">
                                    <strong>필수사항:</strong> keywords 배열 반드시 제공
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Template 3 -->
                    <div class="template-card">
                        <div class="template-header">
                            <div class="template-number">Template 3</div>
                            <div class="template-name">Progressive Learning</div>
                            <div class="template-subtitle">검증된 클래식 학습법</div>
                        </div>
                        
                        <div class="template-content">
                            <div class="template-flow">
                                <div class="flow-step">
                                    <span class="step-number">1</span>
                                    <span class="step-label">무자막 x2</span>
                                    <span class="step-desc">반복 듣기</span>
                                </div>
                                <div class="flow-arrow">→</div>
                                <div class="flow-step">
                                    <span class="step-number">2</span>
                                    <span class="step-label">블랭크+한글 x2</span>
                                    <span class="step-desc">단계적 이해</span>
                                </div>
                                <div class="flow-arrow">→</div>
                                <div class="flow-step">
                                    <span class="step-number">3</span>
                                    <span class="step-label">영한자막 x2</span>
                                    <span class="step-desc">완벽 마스터</span>
                                </div>
                            </div>
                            
                            <div class="template-features">
                                <div class="feature">
                                    <strong>유튜브 썸네일:</strong> "검증된 shadowing 학습법", "전통적인 단계별 영어"
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 사용법 가이드 -->
                    <div class="usage-guide">
                        <h2>사용법 가이드</h2>
                        <div class="guide-steps">
                            <div class="guide-step">
                                <div class="guide-number">1</div>
                                <div class="guide-content">
                                    <h3>템플릿 선택</h3>
                                    <p>학습 목적과 시간에 맞는 템플릿을 선택하세요</p>
                                </div>
                            </div>
                            <div class="guide-step">
                                <div class="guide-number">2</div>
                                <div class="guide-content">
                                    <h3>키워드 설정</h3>
                                    <p>Template 2는 키워드 필수, Template 1,3은 선택사항</p>
                                </div>
                            </div>
                            <div class="guide-step">
                                <div class="guide-number">3</div>
                                <div class="guide-content">
                                    <h3>파일명 확인</h3>
                                    <p>YYYYMMDD_HHMMSS_tp_X.mp4 형식으로 생성됩니다</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 설정 페이지 -->
            <div class="page" id="settings-page">
                <div class="page-header">
                    <h1 class="page-title">설정</h1>
                    <p class="page-subtitle">YouTube API 및 시스템 설정을 관리합니다</p>
                </div>

                <div class="settings-container">
                    <!-- YouTube API 설정 섹션 -->
                    <div class="settings-section">
                        <h2>YouTube API 설정</h2>
                        <div id="settings-status" class="settings-status"></div>
                        
                        <div class="settings-info">
                            <p>YouTube API를 사용하려면 Google Cloud Console에서 API 키를 생성해야 합니다.</p>
                            <ol class="setup-steps">
                                <li><a href="https://console.cloud.google.com/" target="_blank">Google Cloud Console</a>에 접속</li>
                                <li>새 프로젝트 생성 또는 기존 프로젝트 선택</li>
                                <li>YouTube Data API v3 활성화</li>
                                <li>OAuth 2.0 클라이언트 ID 생성 (웹 애플리케이션 유형)</li>
                                <li>승인된 리디렉션 URI에 <code>http://localhost:8080/api/youtube/callback</code> 추가</li>
                                <li>Client ID와 Client Secret을 아래에 입력</li>
                            </ol>
                        </div>

                        <div class="settings-form">
                            <div class="form-group">
                                <label for="client-id">Client ID *</label>
                                <input type="text" id="client-id" placeholder="YOUR_CLIENT_ID.apps.googleusercontent.com">
                                <small>Google Cloud Console에서 생성한 OAuth 2.0 Client ID</small>
                            </div>

                            <div class="form-group">
                                <label for="client-secret">Client Secret *</label>
                                <input type="password" id="client-secret" placeholder="YOUR_CLIENT_SECRET">
                                <small>OAuth 2.0 Client Secret (안전하게 보관됩니다)</small>
                            </div>

                            <div class="form-group">
                                <label for="project-id">Project ID</label>
                                <input type="text" id="project-id" placeholder="your-project-id">
                                <small>Google Cloud 프로젝트 ID (선택사항)</small>
                            </div>

                            <div class="settings-actions">
                                <button class="submit-btn" onclick="saveYouTubeSettings()">설정 저장</button>
                                <button class="btn btn-secondary" id="test-settings-btn" onclick="testYouTubeSettings()">연결 테스트</button>
                                <button class="btn btn-danger" onclick="clearYouTubeSettings()">초기화</button>
                            </div>
                        </div>
                    </div>

                    <!-- YouTube 연결 상태 섹션 -->
                    <div class="settings-section">
                        <h2>YouTube 계정 연결</h2>
                        <div id="youtube-auth-status"></div>
                    </div>

                    <!-- 추가 설정 섹션 (향후 확장용) -->
                    <div class="settings-section">
                        <h2>시스템 설정</h2>
                        <div class="settings-item">
                            <label>
                                <input type="checkbox" id="auto-upload" disabled>
                                완료된 작업 자동 업로드 (준비중)
                            </label>
                        </div>
                        <div class="settings-item">
                            <label>
                                <input type="checkbox" id="delete-after-upload" disabled>
                                업로드 후 로컬 파일 삭제 (준비중)
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 관리자 페이지 -->
            <div class="page" id="admin-page">
                <iframe src="/admin" style="width: 100%; height: 100%; border: none;"></iframe>
            </div>
        </main>
    </div>

    <!-- JavaScript 파일들 -->
    <script src="frontend/js/common.js"></script>
    <script src="frontend/js/manage.js"></script>
    <script src="frontend/js/single-clip.js"></script>
    <script src="frontend/js/batch-clip.js"></script>
    <script src="frontend/js/youtube.js"></script>
    <script src="frontend/js/settings.js"></script>
    <script src="frontend/js/navigation.js"></script>
</body>
</html>